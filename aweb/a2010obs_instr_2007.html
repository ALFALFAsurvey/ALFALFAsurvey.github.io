
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
  <head>
    <title>ALFALFA Survey - Observations for A2010</title> 
  </head>
<body bgcolor="ffffff">
<h2><font color=darkblue>ALFALFA Survey - Setup and Observing Cookbook
&nbsp &nbsp Current as of March 1, 2007</font></h2>

<br>
<b><font color=#cc0f14>Disclaimer:</font> CIMA changes, conditions change, and we have
to adapt to situations as they develop; this cookbook works today but may not
tomorrow! In particular, as of February 20, 2007, we are using the CIMA version
<b>2.2.17</b>, known as the <b>Normal</b> Version. Please read the documentation on the <a 
href="http://www2.naic.edu/~cima/">CIMA website</a>. If you want to experiment with
CIMA offline, <font color=darkorange>be careful not to overwrite or change the observing files!</font></b>
<br>

<h2><font color=darkblue>Before Observing</font></h2>
<ul>
<li> The ALFA cover must have been removed. ALFA is covered during radar runs, so take a look 
at the telescope schedule beforehand. For instance, if it looks like ALFA had to be covered 
the day before your observations, make sure that time is allocated to remove the cover before 
your run starts  (this can be done during maintenance or system check time). In any case, it 
is a good idea to double check with the telescope operator.  Know the schedule a few days 
ahead of time.
 
<li>The ALFA motor must be switched on (this can be done from the control room!). If you have any doubts, 
look for ALFA rotation using the dome video monitors (you should be able to see it move). 
Also, the operator may need to turn on ALFA in software from the control room.

<li> Ask the telescope operator to move to the appropriate azimuth and
approximate zenith angle for the night and, if necessary, to rotate
ALFA into place. <i> Ask him/her to do this <b> before </b> starting
GALSPECT.</i>.
 For the a2010 project, the telescope is fixed at AZ= 360 for Declinations < +16 degrees, and at AZ =180 for
 Declinations > 20 degrees.  The scenario is still be determined for
 other values. (Note that we use azimuth=360 rather than azimuth=0 to
 avoid wrap issues. Note also that Az=180 is equivalent to Az=540:
 choose the value that has the smallest movement from the current position.)<br>
<b> For Spring 2007, the azimuth should be set to
180 (or 540) most nights,  since we are mostly observing north of
zenith, but some nights will require an azimuth
of 360 (NOT 0). Be sure to CHECK THE SCHEDULE.  </b>

 

   <i> Be sure the 
     operator returns telescope control to you. </i>  Note that once you start up CIMA, you'll take over
control of the telescope motion and it will stop. So  wait to start up CIMA. In the meantime, have
the operator start up GALSPECT (see below).

<li> <b>Set up the TOGS starting position.</b> Open up the catalog file <font color=#cc0f14>
/share/obs4/usr/a2010/a2010.cat </font> and  
edit the entry called galfasrc to the new right ascension and declination for
that night. As exact start times and slew times 
can change, the observer needs to be ready to adjust the entry by estimating as the previous
observer is finishing, and again during setup if there are delays, when the telescope will 
be on the meridian.  This needs to be done as quickly as possible. We suggest also that you
take a look at the <a href="docs/instructions_togs.pdf"> TOGS setup
document</a> (provided by the TOGS group) to understand a bit about their setup.
</p>
</ul>

<h2><font color=darkblue>TOGS GALFA setup - the operator will carry out this step.</font></h2>
<ul>
<li>Login to any machine in the control room to begin the GALFA startup.
<li>Secure shell to the dataview machine:  <b>ssh -l guest dataview</b>
<li>Secure shell to the galfa machine:  <b>ssh -i galfa_key galfa@galfa1</b>
<li>Enter the command:  <b>/var/levels_togs</b>.  If you get the message 
<i>LO2:  Set failed, got back:  ERROR setting freq</i>, then you need to start the gpib on the 
wapp server.  To do this, pull up another xterm, and ssh to the wappserver via
<b>ssh
wapp@wappserv</b>.  Ask Brian for the password.  Once logged on, type <b>source 
/share/wappsrc/bin/start_gpib</b>.  Go back to the xterm logged into galfa1 and again type 
<b>/var/levels_togs</b>.  This will run for the rest of the night, so minimize the windows.  

<font color=#cc0f14><i>Note: if the operator is not able to get GALSPECT to run, he/she should call the 
<a href="http://helios.astro.lsa.umich.edu/~mputman/togscontact.html">TOGS contact</a> for
the night.</i></font>
</ul>

<h2><font color=darkblue>Datataking</font></h2>
<ul>
<li> Quickly log into OBSERVER2 as "dtusr" (password taped to the monitor). </p>

<li> When ALFA is in place and you are close to the target position,
     <b> start CIMA </b> by clicking with the right button of the mouse on the background. (When you start
     CIMA, slewing will stop until you issue the observe command, and if you are not close
     to target position, you will have to wait later.) Choose
     "Cima Online GUI" from the menu. Select the <b> version we are currently
     using, the "normal" version 2.2.17 </b> (effective 20Feb2007).
     The <font color=#cc0f14>Start New CIMA </font> window will pop up in which you need to enter some
identifying information.

</p>
<li><b><font color=#cc0f14>Start New Cima Session</font></b>
<ul>
  <li> Project number: <b> a2010</b>. This is important. Your settings and log files will be saved 
      (if you decide to do so) in the corresponding project directory, which for us is 
      /share/obs4/usr/a2010/. <i> Note that if you enter captial "A"
      it will be changed to small "a"</i>.
  <li> Observer: <b>Your name</b> for entry in operator's logbook.
  <li> Select <b> Line </b>observing mode. 
  <li> Click <b> Accept </b> and CIMA will start up.


Now, several windows will pop up: the
<font color=#cc0f14>CIMA Observation Status</font> window, the <font color=#cc0f14d>CIMA Log Display</font> window, 
the <font color=darkorange>CIMA Observer's Interface</font>, the <font color=#cc0f14>CIMA executive</font> (<font color=#darkred>
red font</font>) and a widget 
entitled <font color=#cc0f14>Choose Receiver</font>. The <font color=darkorange>CIMA Observer's Interface</font>
is the main window and should always be open. The buttons therein open new windows, which allow you
to control the telescope. These windows will be indicated with <font color=darkorange>orange</font> fonts
in this document; all the other ones will be <font color=#cc0f14>red</font>. </p>

<li><b><font color=#cc0f14>Choose Receiver</font><br> </b>
     Select <b>ALFA,</b> <b> disable quick Tsys,</b> then click on <b>
     Select Receiver Now.</b> Make sure that ALFA shows up in the AOSTATUS 
     monitor (to your left on top if you are in the control room).  

Keep an eye on the <font color=#cc0f14>CIMA Log Display</font> and don't move to the next step until the
previous has completed; if you click too fast, you run the risk of getting an "executive busy" command.

</li></ul></p>
<li>Under <b> <font color=darkorange> Utilities</font></b> in the CIMA Observers Interface window,
<font color=#cc0f14> <b>Restart the WAPPS.</font> </b>
When the output to log window is complete, dismiss the window.
</p>
     

<li>If running TOGS, immediately click on <font color=#cc0f14><b>Command File 
Observing</b></font>, and click on the <b>Load</b> button. Choose the file <b>command_galfasrc</b>.
The file should appear in the right hand box. Be sure that "Run Command File" is set to
<font color=#darkblue>Once</font> and "Start From" is set to <font color=#darkblue>First line</font>.
Click <b>Run</b> to run the file. The telescope will slew to the position you just set for 'galfasrc' in the 
a2010.cat file, which should be very close to the meridian.  As soon as it gets there it will load the 
togs.gui file, their IFLO setup, and begin 
about 6 minutes of frequency switching calibration.  One only needs to
let it run.  During this time, you can use the waterfall dataview application on the dataview machine to see that data is be 
taken.  You may also open the log files if you wish.<br>

<font color=#cc0f14><i>Note: if the GALSPECT spectrometer is not set up within ten minutes of their allotted time (so that
the ~6 mins of calibration cannot be run before A2010 is scheduled to start), do not run the TOGS
calibration if the prime A2010 map LST range is reached. But, even if you don't run it at the beginning, 
run the TOGS calibration at the end, if there is time and GALSPECT is running.</i></font>
<br>
As soon as the TOGS calibration is done, <b>Close</b> the command file window and
proceed with the ALFALFA setup as usual.
</p>
<li>Click on <font color=darkorange>Load/Save State </font> (from the <font color=darkorange>CIMA
    Observer's Interface</font>). 
<ul> <li>Select  <b> Load a Saved State </b>. The setup file depends on
    the azimuth: <b>a2010_az360.gui</b> (Azimuth 360) or <b>a2010_az180.gui</b> (Azimuth 180/540).  
    It fires the cal at the end of each 
    scan ("loopend-OFF"), and adopts the topocentric reference frame. This will 
    set most of the parameters, but you must still apply the
    configuration in each of the widgets described below. Select the
    appropriate file and click <b> Continue </b> when loaded.
<li> <b> Dismiss the Load window. </b>
</ul></li></li>
</p>

<li>Click on <font color=darkorange>Pointing Control</font>. Here we will set the ALFA parameters and point the
telescope. If you have run TOGS, ALFA should be in place and the
telescope should be close to the correct azimuth. If you have not run TOGS, double-check that ALFA is in place. 
The telescope won't move until the receiver floor has
       finished rotating (to ALFA, from some other receiver).  Also note that the "Configure Wapps" will not work, 
       and you won't get data flowing from all the beams ( you can tell this from the alfadatawin program on the
       dataview machine.) 
<ul>
  <li> For a2010, we maintain a source "catalog"
  <b>a2010.cat</b>. Check at the top of the window if this file is
       loaded, and, if not, load with the "Catalog" button (on the top
       left). 
  <li> Choose the appropriate drift***p* "source" corresponding to the
       current observing block from the list of drifts.
       You can also type the coordinates of the source (RA and Dec);
       if you do so, be sure to use epoch J2000.
<li> If necessary, update the RA to the current LST. This can be done
       in a2010.cat before opening the <font color=darkorange>Pointing
       Control</font> menu.
<li> Click <b> Point </b> and continue with the following while the
       telescope points.
<li> Check that velocity is set to <b>0</b>, reference frame to <b>topocentric</b> and type to <b>optical</b>.
  <li>Click <b> ALFA Rotation Control Window</b>. In the menu that
       pops up, set <b> Rotation angle </b> to +19.0 (degrees) and hit <b>Send</b>.
       You can actually see if ALFA is rotating by looking
       at the TV camera in the control room (ask the telescope operator to show the appropriate camera).  
       The blue number next to the "Send" button should change to your entry once ALFA reaches that position.
       (For drifts at 0 or 180 degrees azimuth, the correct angle to give equal Declination beam 
       spacing is thought to be 19 deg. At azimuth 90 deg, it is thought to be -14 deg.)
       Once ALFA has rotated into position, click <b> Close
       </b>. (Note that ALFA should be at 19 if you have run TOGS, but
  that we do this step to make sure.)
  <li> Back in the <font color=darkorange>Pointing Control</font> window,
  click on <b>0</b> to choose beam 0 as the ALFA center.
  <li> Note: if there are problems with ALFA not responding (e.g., it
  doesn't rotate), click <b>Restart ALFA </b> under the 
<font color=darkorange> Utilities </font> menu.
</ul>
</p>

<li>Restart the WAPPs under<font color=darkorange> Utilities</font> as above.
</p>

<li>Click on <font color=darkorange>Receiver IF/LO Control</font>
<ul>
  <li> Make sure that ALFA is selected, then click <b>New Improved
  IFLO Setup </b>. This will open 
       the <font color=darkorange>New Improved IFLO Control</font>
       window.
</p>

<li><font color=darkorange>New Improved IFLO Control</font>
<ul>
  <li> Both "Choose Receiver" and "IFLO Path" should be set to ALFA. Note that this is another place where
       you can select the receiver (several functions are redundant).
  <li> Check that the rest frequency is 1385.0 MHz for topocentric (as opposed to 1420.4058 if doppler
       tracking is used), that the Destination is WAPP, and that the four bandwidths are all 100 MHz.
  <li> Hit <b> Apply This Setup</b>.  It will take a few seconds to respond: watch the observation log display window.
  <li> Dismiss <font color=darkorange>Receiver IF/LO Control</font> and 
       <font color=darkorange>New Improved IFLO Control</font> windows.
  <li> Confirm in CIMA log window that IFLO parameters are set before moving. (Make sure you wait until
       the frequency is set before proceeding!)
</ul></ul>
</p>


<li>Click <font color=darkorange>Backend Control</font>
<ul>
  <li> The <b>WAPP ALFA</b> window should pop up. <br>
  <li> Check that the configuration is "2 chan, 3-level auto."  If not,
choose it from the pull-down menu (click on the displayed configuration
[in red] with the left 
       button of the mouse).
  <li> Here, you can leave cal to "nocal" and Secs to "5" because we don't use this.
       The number of seconds for its duration is only relevant if you 
       choose to test the cal by pressing the "Start Cal" button.
  <li> Check that the integration time (i.e., how often the data are written to file) is 1 sec.
  <li> Ignore the "Piggyback GALFA" button, and leave the radar blanker <b><font color=darkblue>OFF</font></b>.
  <li> Hit <b> Configure WAPP ALFA</b> to apply your setup, ONLY AFTER ALFA is in place. Make sure the log
       display window indicates that the WAPP configuration is finished.
  <li> Adjust power, and look at the numbers on the <font color=darkorange>Backend Control</font> window:
       1+/- 0.2 is ok. If the numbers are zeros (or close to zeros), trying redoing the startup sequence: 
       <i>This appears to depend on the order in which you do things</i>. If that doesn't work, probably 
       the ALFA amplifiers have 
       not been turned on. If this is the case, you can ask the telescope operator to turn them on 
       for you, or you can do it yourself by typing "/home/aoui/bin/alfaon" on an xterm (FYI:
       "/home/aoui/bin/alfasafe" turns the ALFA amplifiers off).
       If the power is now back, but the numbers look wrong, try adjusting the power a few times. 
  <li> The bottom part of the window is the "Monitor Control". Do not worry about it (it is meant to
       display the signal from one beam and one polarization at a time on the monitors sitting on the
       top shelf of the wall to your right, in the control room). Just make sure that the control
       is set to "Remote" and not to "Local".
</ul>
</p>
	
<li>Click <font color=darkorange>Spectral Line Observing</font>. This opens Spectral Line Observer's Widget you'll be using most of the night. Note it also has buttons that allow you to "start a new fits file" and "adjust power".
<ul>
  <li> Choose your observing mode from the "Mode" pull-down menu.  
For all a2010 observations, use the "Fixed Azimuth Drift Map" mode.  
In this mode, the name of the drift and the starting RA are taken from
the <font color=darkorange>Pointing Control</font> window.  
<li>Make sure that the starting RA is sufficiently later than current RAJ from the right most view screen,  so
that the telescope can be in position before that RA drifts into the beam, but not so much 
that you waste a lot of time. (A typical value is ~60 secs from now, but it depends on how close
     the telescope is now positioned.)
<li> <b> Check the azimuth value </b> to confirm that it is correctly set to
180 or 360. (Note 180 is equivalent to 540 and telescope will know to
go to the closer angle, so you do not need to change to 540.)
<li> The remaining values should be loaded from the configuration
files. Be sure that they are set properly (you can do this after
hitting <b> Observe </b> (see below) and abort if you see an
error.) The proper values are:
<ul>
<li> <b>Source</b> is the appropriate <font color=#cc0f14>driftMMMpN</font> (from the a2010.cat).
<li> Epoch should be <font color=#cc0f14>J</font>
<li> RA is set to ~60 seconds from now.
<li> Declination should correspond to that given in a2010.cat
<li> ALFA rotation angle is correct, usually <font color=#cc0f14>19</font> degrees.
<li> Drift type is set to <font color=#cc0f14>Follow Dec J2000</font>
<li> Scan length is set to <font color=#cc0f14>600</font> seconds
<li> Number of loops is set to cover length of run. Easiest to leave
it at the default 99.
<li> New FITS (each loop) is set to <font color=#cc0f14>1</font>.
<li> Calmode is set to <font color=#cc0f14>loopend=ON</font>
<li> Caltype is set to <font color=#cc0f14>hcal</font>. We do not use an "extra" cal.
<li> Cal Secs is set to <font color=#cc0f14>1</font> and Async secs to <font color=#cc0f14>0</font>
<li> Adjust power to <font color=#cc0f14>first loop only</font>; ignore Cal Only.
These settings allow for a 600 second scan and 1 sec cal scan to be placed in a single FITS file of about 212 MB. 
</ul>
<li> If you have moved at all since the last time, hit Adjust Power Again.
<li>Otherwise, hit <b>Observe</b> and make sure that the slew time is less than the wait time displayed
in the  <font color=#cc0f14>AO Observer Display</font>.
If not, hit "Abort" and set a slightly later RA. Start a new FITS
file just in case and hit <b>Observe</b> again.
</li></ul> </p>
 
<li>During observing, do the following (see <a href="#datam"> Data
Monitoring section </a> for useful tools):
<ul>
<li> <b> Monitor your data: </b> watch
particularly for power dips, GPS, birdies, and gaps in the data. 
Be vigilant for new sources of RFI; carefully check the waterfall plots and/or quicklook.</b>
Know the expected locations in the band of the "usual suspects". The
FAA radar is usually at 
1350 MHz (although they sometimes use 1330 MHz, out of our bandpass!)
For example, strong RFI at 1367 and 1382 MHz is due to the
Punta Salinas naval base radar, which should <b>not</b> be on during
ALFALFA run.

(see <a href="http://www.naic.edu/%7Erfiuser/smarg-coordPS.html"> this link</a>).
<li> <b>Watch for WAPP errors </b> and follow procedure to <a href="#wapp"> recover from WAPP
errors </a> below.
  <li><b> Maintain a log file, </b> with an entry for each new fits
  file that is written. The file should be in /share/obs4/usr/a2010/ &nbsp ; 
      if it's not there, make one using the format logYYMMDD. <a
      href="#log"> More instructions </a> below.


<li> <b> Check the declination </b> on the monpnt window to confirm that it
 remains near the J2000 value (within a few arcseconds). 
    
   <li> If you abort a scan during the night with the "Abort" command
   in the <font color=darkorange>Spectral Line Observing</font>
   widget, be sure to <b>start a new fits file </b> before observing again; if you don't, the two scans (the one you aborted and the new one) will be in the same fits file, complicating the data reduction. 

<li> Sometimes the WAPPS are left in an uncertain state if a scan is aborted abruptly. Be sure
to <b>restart the WAPPs</b> after aborting a scan-in-progress (i.e. after data taking starts), and then make 
sure to <b>reconfigure</b> them. Unfortunately this means that you have to readjust the power, so you
really want to be careful not to abort needlessly. 

<li> See <a href="http://www.naic.edu/%7Ea2010/troubleshooting.html">
observational troubleshooting list</a> for other observing issues.)

</li>


</ul>

</ul>

</p>

<li><b>Ending the Observations</b>
<ul>
<li>When finished, abort the last scan, after a few seconds of
integration time.
<li>If running TOGS (if not, skip to next step), 
<ul> <li> <b>Restart the WAPPS</b> using that option under  <font color=#cc0f14>Utilities</font>.
Note any error messages; if there are any, try again.
<li>Click on <font color=#cc0f14>Command File Observing</font>, and click the <b>Load</b> 
button.  Choose and <b>run</b> the script <b>command_galfacurpos</b>.  This will again load the togs.gui 
file and IFLO setup, and begin the TOGS calibration at the current telescope position.  Let the 
calibration finish (about 6 minutes) and then follow the exit procedure as normal.
</ul><li> Select <font color=darkorange>Exit normally</font> to exit
       CIMA. 
<li> Exit data monitoring programs.
<li> Log out of observer2.
<li> The operator will end the galspect process. (The procedure is 
to pull up the window running GALSPECT, and hit CTRL-C to exit.  Logout of 
the galfa1 machine and then exit dataview.)


</ul>
</ul>

<a name="wapp"></a>
<h3><font color=darkblue>Recovering from WAPP errors</font></h3>
<ul>
  <li> The only sign of WAPP errors in CIMA is that messages appear in <font color="red">red</font> in the
    CIMA log window. WAPP error messages include: <font color="red"><i>WAPPs confused</i></font>
    or <font color="red"><i>WAPP (3) ERROR - Counts don't match for chip 1</i></font>. The latter indicates
    a hardware problem on WAPP3. Occasionally there is no warning message from CIMA, but the countdown
    time on the aostatus window stops, meaning that the WAPPs are no longer taking data.
    Sometimes the problems go away, so try to restart
    the WAPPs and then the observing again. To do this:
    <ul>
    <li>
          <li>Abort Observation in, e.g.,  the <font color=darkorange> Spectral
          Line Observing Widget </font>
          </li><li><b>Restart ALL WAPPS </b>under <font color=darkorange>
          Utilities </font>
         </li><li><b>Adjust power</b> in the <font color=darkorange> Spectral
          Line Observing Widget </font>
          </li><li><b>Configure WAPP ALFA </b>  in <font color=darkorange>
          Backend Control </font>
          </li><li>Start a <b>New Fits File</b> in <font color=darkorange>
          Backend Control </font>
          </li><li>Adjust RA for new observation in  the <font color=darkorange> Spectral
          Line Observing Widget </font>
          </li><li>Hit <b>Observe </b>  in  the <font color=darkorange> Spectral
          Line Observing Widget </font>
          </li><li> Once drift starts, confirm coordinates. (Sometimes
	  control returns to telescope operator rather than observer.)
          </li></ul>
 If this does not work, try again, up to a few times. If this still does not help,
      exit CIMA and start again.
  If the <font color="red">error messages keep appearing</font>,  it will be necessary to have the operator call an engineer to
    look into the problem. Currently, the WAPP experts are Giacomo Comes, Arun and Ryan Seal.
<p></p>


   <li> If you abort a scan during the night with the "Abort" command in the <font color=darkorange>Spectral Line Observing</font> widget, be sure to start a new fits file before observing again; if you don't, the two scans (the one you aborted and the new one) will be in the same fits file, complicating the data reduction. 

<li> Sometimes the WAPPS are left in an uncertain state if a scan is aborted abruptly. Be sure
to <b>restart the WAPPs</b> after aborting a scan-in-progress (i.e. after data taking starts), and then make 
sure to <b>reconfigure</b> them. Unfortunately this means that you have to readjust the power, so you
really want to be careful not to abort needlessly. 
</ul>

<br>
<a name="datam"></a>
<h2><font color=darkblue>Data Monitoring</font></h2>

Mikael has developed a great package for telescope monitoring and data
display. 
These programs read the data that are being broadcasted to the FITS files, and not
the FITS files themselves. The screens are updated every 10 seconds.<br>

On Dataview, click on the background and select from the menu:
<ul> 
  <li>Quicklook Data Display  -- launches the ALFA on-line display. Click 'ALFA Pattern' and 'Diagrams - Waterfall' to 
see all 7 beams 
  <li>Observers Monitor -- opens a widget that gives the power levels. Normal power levels are coded in blue.
  <li>Array Rotation -- shows ALFA rotation
      angle - check at beginning of night.
  <li>ALFA Beam Position -- shows approximate positions of each beam; can set to RA,Dec (note:
    currently, the positions aren't quite perfect but still helpful.) Check at beginning of night.
  <li>Frontend Monitor -- launches the ALFA instrument monitor,
		       showing voltages, currents, and temperatures
		       in all beams (same display as to the right of the operator's station)..

</ul>
You can open the same widgets by typing on an xterm on a linux machine:
<ul> 
      <li>/home/cima/bin/<b>alfadatawin</b> -- waterfall plots in your color of choice.  Too cool.  Enough said. 
      <li>/home/cima/bin/<b>alfaobswin</b> -- power for each beam
      <li>/home/cima/bin/<b>alfamotorwin</b> -- ALFA rotation angle 
      <li>/home/cima/bin/<b>alfabeamwin</b> -- beam positions
      <li>/home/cima/bin/<b>alfamonwin</b> -- instrument monitor 


</ul> 
The program alfadatawin is currently only available on Linux machines. The other commands are available
on other machines, too. Notice that you will not be able to start <b>alfadatawin</b> if the process 
is already running on dataview (started by one of the previous observers). If this happens, ask the 
telescope operator to contact Mikael, Arun, or Phil to kill the previous process(es).

<h3><font color=darkblue>Notes</font></h3>
<ul>

  <li> In particular, use these displays to monitor the power levels. Notice that after hitting
       "Observe" the CIMA monitor WAPP power levels <i>do not update</i>, whereas the monitoring windows 
       show the current levels.</p>

  <li> After a cal, the WAPP power levels will spike and so the
  displays will momentarily change scale.

  <li> If you reset the WAPPs, you will have to exit and restart alfadatawin to get it to grab 
       the online data again.</p>

  <li> To log out of dataview at the end of the observing run, close the windows "politely" by hitting 
       exit in each display window before logging out. This will make sure that the processes terminate.</p>
</ul>



<a name="log"></a>
<h2><font color=darkblue>Log files</font></h2>

It is very important to keep an accurate log of what happens, even to note "an uneventful night".  To do so:
<ul>
  <li> ssh to another machine as <i>a2010</i>
  </li><li> open a new file <b>logYYMMDD</b> in <b>/share/obs4/usr/a2010</b> using your favorite
text editor.  Use a posted log file as the template.
  </li><li> record **anything** of note, especially
<br>(1) the CIMA version number and the saved state (a2010_az360.gui or a2010_az180.gui)
    <br>(2) any bad files,
    <br>(3) any power adjustments,
    <br> (4) unusual rfi etc. (see <a href="http://www.naic.edu/%7Ea2010/troubleshooting.html"> observational troubleshooting list</a> to check
<br>To quote Brian: <i> I cannot stress the importance of keeping accurate logs.
While the file conversion software works automatically, it is good to have a backup to check against when
comparing scan numbers.  Sometimes CIMA squeezes in extra scans at the beginning or end of the run, or
has some other unpredictable behavior.  It is also important to note "empty" files, as IDL will hiccup on these.</i>
The folks who calibrate/process the drifts you take will thank you for your carefully note-taking (and will be entirely
justified in saying unkind things about you otherwise).
</ul>
</li></ul>
<p></p>



<br>

<h2><font color=darkblue>After Observing</font></h2>
After the run has finished, do the following things to keep the rest of the a2010 group informed about how the run is
going.

<ul>
<li> Follow the instructions in the <a href="http://www.naic.edu/~a2010/todo_endrun.txt"> list of tasks to do after each
run </a>. &nbsp; Details about IDL portion are given below.
<li>Check with the scheduling team about other mods that they or you should make.
If anything <i>important</i> happened, send a message to RG and MH.

</ul>
<h2><font color=darkblue>Reading Data into IDL and saving to Disk</font></h2>
Once a observing session is complete, all the FITS files can be converted into a set of IDL structures for 
future use; ask Brian about any details about this. It is probably best to do this at your "office" workstation 
at AO, and run the job on one of the fusion machines. Below, IDL> means "inside idl".
<ul>
<li> Login as user a2010.  The  ".idlstartup" file in ~a2010 is configured with the proper routines, which are 
located in /share/a2010/idl and its subdirectories.
<li> Change to the data directory /share/a2010/data/<i>{run_directory}</i>  (ie /share/a2010/data/07.02.17/
<li> Filecreator needs as input a list of the FITS files with full path names that you wish to process.  The 
best way to do this is <pre> ls /share/pserverf.sda2/wappdata/wapp.YYYYMMDD.a2010.* > filesYYYYMMDD.txt </pre>  
This will put all the a2010 files from that date into the text
file. Check your log to confirm the directory.
<li> This next step is very, very, VERY important.  You MUST consult the log to see what files should be 
removed from this list.  If there are files that have no data (ie the files at the end of the run), they 
will cause the filecreator program to hiccup, and therefore should be removed from the list.  If there are 
files you KNOW contain junk, remove them from the list.  ALSO, if you run crossed over midnight, you may 
need to add or delete files.  You can ls, grep, do whatever you want to make the list, just make sure that 
the list contains all the viable files you wish to process for a
single observing run. Make sure that there is no blank line at the end
of the list, or filecreator will crash.
<li> Start up IDL in /share/a2010/data/<i>{run_directory}</i> by typing idl
Make sure that you are on 
a fast machine (fusion01, fusion02, aolc1,2,3,4,6,g,h,j,k,m,o,p), and
that someone 
else isn't using up all the cpu (do a
"top" to check that).
<li> IDL>@wasinit2  &nbsp &nbsp &nbsp &nbsp (If this doesn't work, check that your idl account is <a
href="http://www.naic.edu/~a2010/idl_startup.txt">set up properly</a>)

<li> IDL> .com filecreator
<li> You are now ready to process a run's data.  There are five different file types that will be created:
<ul>
	<li>sssssssss.sav - A 600 second d structure *.sav IDL file
        <li>ssssssssCALOFbegin - The first record of a drift used as a cal off
        <li>ssssssssCALOFend - The last record of a drift used as a cal off
        <li>ssssssssCALON - A 1 second CALON
	<li>ssssssssCALOF - A 1 second CAL off 
</ul> 
<li> IDL> filecreator, filelist 
<li> filelist is a string of the filename you created
above, ie 'files20070223.txt'. 
<li>The files being created will be reported on screen as the job is done.  In addition, the names of the CAL
files will be written to the file 2007-MM-DD.CALlist.  This list is important, as it will form the calibration structures from the procedures
calib1 and calib2.
<li> <b>Example from February 23, 2007</b>:  There were 26 files made that night, so I created a list in the 
/share/a2010/data/07.02.23/ directory with ls
/share/pserverf.sda2/wappdata/wapp.20070223.a2010.*.fits >
files20070223.txt and ls /share/pserverf.sda2/wappdata/wapp.20070224.a2010.*.fits >>
files20070223.txt, because the run crossed midnight.  However, upon
examining the log I see that files 15 and 11 were aborted.  I removed
these files from the list, as they contain no data.  I then start IDL
with idl while on one of the fast machines listed above.  I compile
filecreator as above, and then invoke the command:
<li> IDL> filecreator, 'files20070223.txt'
<li> IDL goes to work.  When the job is done there will be many IDL save files, CALON files, and CALOFbegin and CALOFend files, the
filesYYYMMDD.txt you created, and a new CALlist file.

</ul>

<br>





<br>
<h2><font color=darkblue>Useful Links</font></h2>
<ul>
<li>The <a href="http://www.naic.edu/~a2010/galaxy_a2010.html">A2010</a> project website
<li>The <a href="http://egg.astro.cornell.edu/alfalfa">ALFALFA</a> website.
<li>The <a href="a2010whereintheworldis.html"> Where in the World is...</a>
<li><a href="checklista2010.html">Observing checklist</a>
<li><a href="remote_obs.htm"> Remote Observing Checklist </a>
</ul>




<hr>

<font color=#cc0f14>
Page created and maintained by the members of the
<a href="http://www.astro.cornell.edu/Galaxy/egg.html"> Cornell ExtraGalactic Group</a></font>
and their ALFALFA team friends<br>

<!-- hhmts start -->
Last modified: Thurs Mar 01 17:40 EST 2007 by becky<!-- hhmts end -->
</body>
</html>
    
